## 微服务中的数据

***

微服务是解耦业务的很好的方式，但是对于其中的数据查询往往让人头大。微服务中难以避免进行跨服务查询，但是分属不同服务的数据往往数据库、表结构以及查询方式很难保持一致，为了解决这个问题需要付出很多额外的成本。

一般来说，跨服务查询会有以下几种方式：

1. 冗余数据，将需要跨服务查询的数据直接冗余进各个服务中或者直接建立一个冗余数据库，这样的好处就是查询起来很方便，在各个服务中一条语句就能实现，坏处是冗余数据实时性不高，需要额外的业务逻辑来维护，比如订阅其他服务的更新事件，当有其他服务数据发生更新时同步更新本服务的数据，如此一来需要订阅很多服务不说，每次更新数据所造成的影响也是难以预估的，订阅依赖层级很深且处置不当容易造成雪崩式的更新

    适用场景：被冗余一方数据较为稳定，且主动冗余方数据量可控的场景

2. 表同步，将需要跨服务的数据使用各种工具将整张表同步进不同的db中，这样的好处是查询起来仍然很方便，但是耦合会比较大，服务间会存在数据库级别的耦合

    适用场景：被同步一方结构较为稳定，同步方案比较成熟的场景

3. 数据拼接，不进行任何数据层面的冗余，所有操作都交给业务逻辑，通过业务逻辑进行各种正查（通过本数据库字段查询再分别拼接外联数据信息）或者反查（通过外联数据信息过滤再使用外键反向查询本数据库信息）来完成最终数据的拼合，这样做的好处是不需要任何数据层面的同步更新，坏处也是很显而易见的，首先业务逻辑会变得很重，可能会难以理解，其次查询速度难以保证，普通的正向查询还好，反向过滤后如果数据范围很大那么很有可能会存在可用性问题

    适用场景：无条件宽泛的反向查询、聚合等业务的情况，简而言之对于需要多字段多命中的反查来说不太适合