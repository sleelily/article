# API 规范

------

### API

什么是API？API(Application Programming Interface)是

0.是应用与外界交换数据的途径
1.软件系统不同组成部分交互的约定
2.是资源及操作的抽象

就可用作为标准的话API的实现方式千差万别，但如果以非功能性需求来讲API必须符合统一规范

### REST style

 如果谷歌下“API规范”，99%的内容都是关于REST的内容，那么什么是REST呢？REST(Representational State Transfer)由Roy Thomas Fielding（HTTP规范的设计者）于提出，中文一般译为“表征状态转移”，是一种以资源为中心的API组织风格。我们可以逐字分析来理解其含义，“表征”或者说“表现”就是说资源的表现。隐藏在API后的资源原始格式形形色色，不局限于图片、视频、文本文件或者Databse，如上所说API是资源及操作的抽象，它需要依照请求者提供Accept所描述的格式（一般为JSON、XML等）在原始数据之上做出一个映射层，而API所展现出来的格式就是“表征”，这是资源的外在表现。而“状态转移”是指资源的变化，也就是一般所说的增删改等操作。顾名思义，REST风格的API就是围绕资源的表现形式和对应的各种操作所制定出的一套通用风格。它有以下几个特点：

 1、围绕资源
  所有操作都有对应的表征，资源总是以某种表征展示，即序列化的信息
 2、统一接口
  所有操作都有对应的HTTP method
  GET（SELECT）：从服务器取出资源（一项或多项）。安全幂等
  POST（CREATE）：在服务器新建一个资源。不安全不幂等
  PUT（UPDATE）：在服务器更新资源（客户端提供完整资源数据）。不安全幂等
  PATCH（UPDATE）：在服务器更新资源（客户端提供需要修改的资源数据）。不安全幂等
  DELETE（DELETE）：从服务器删除资源。
 3、URI
  每种资源至少有一个URI与之对应，URI只表示资源，不表示其他任何东西
 4、无状态
  这个比较好理解，HTTP就是无状态的
  单个请求的后果容易预见，风险边界容易把控
  提升系统的稳定性，容易提升内聚性，单个API只需要对自己的内部逻辑负责，对于指定的参数来说容易实现幂等性，便于测试
  提高可扩展性，降低耦合

 REST规范所涉及到的主要有以下几个部分：

 1、协议：一般都是HTTP协议
 2、域名：应该尽量将API部署在专用域名之下
 3、路径：使用资源名称+动名词的格式

  > 如：
   单一资源: /devices/:sn, /users/:user_id 
   资源列表: /devices, /users

 4、动词（方法）：一般如上所示
 5、版本号：通常有两种方式，HTTP头或加到uri中，推荐后者，更简单直观
 6、查询：一般get方法使用queryString，其他方法使用body

 ### 代码组织
 
 一般我们会把系统分层为router > controller > service > model, 但是实际上按系统规模来说，这样的分层方式往往显得过于粗暴，对于简单的系统可能都不需要service层，但是对于复杂的系统，这样的层级又往往满足不了解耦的要求，按图索骥往往会舍本逐末，其实理解好层级的定义恰到好处的完成系统的分层才是我们需要的，一般来说会分为这几个层级，
 
    1、将各种请求映射到下一层的路由；
    2、接收上一层的请求数据，做各种格式校验和序列化操作的处理层；
    3、接收序列化后参数后作出相应动作的业务逻辑层；
        > 不可重用的业务逻辑层
        > 可重用的业务逻辑层
    4、为业务逻辑层提供资源的数据存储层
        > 可对一些共用操作封装出DAO层

 当业务简单时，我们可以选择合并其中几个层来使得结构清晰，业务复杂时不可避免的要拆出多个层级，只要层级分得清楚，其他的概念都是无关痛痒的事

 ### 代码规范

  1、注释不厌精、文档不厌细，注释优于文档，多写注释和文档可以帮自己理清逻辑，找出更好的实现方案
  2、函数内部catch，有利于内聚代码
  3、方法应有自己的参数校验，不能信任调用者
  4、不对过程进行封装，每次封装只做一件事
  5、纯函数优于组装函数，参数返回值更直观、更易编写测试
  6、拒绝“重载”写法，分歧是混乱之源，尤其是对于解释语言
  7、不重复造轮子，包括各种util等
  8、为整个项目负责